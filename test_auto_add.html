<!doctype html>
<html>
  <head>
    <title>Test Auto-Add Functionality</title>
    <style>
      body {
        font-family: monospace;
        background: #1a1a1a;
        color: #00ff00;
        padding: 20px;
      }
      .test-section {
        margin: 20px 0;
        padding: 10px;
        border: 1px solid #333;
      }
      .pass {
        color: #00ff00;
      }
      .fail {
        color: #ff0000;
      }
      .warning {
        color: #ffaa00;
      }
      .info {
        color: #00aaff;
      }
    </style>
  </head>
  <body>
    <h1>ðŸ§ª TEST AUTO-ADD FUNCTIONALITY</h1>
    <div id="test-results"></div>

    <script>
      async function runTests() {
        const results = document.getElementById("test-results");

        function log(message, type = "info") {
          const div = document.createElement("div");
          div.className = type;
          div.innerHTML = message;
          results.appendChild(div);
          console.log(message);
        }

        log("=== INICIANDO TESTS AUTOMATIZADOS ===", "info");

        // Test 1: Verificar que la aplicaciÃ³n estÃ© corriendo
        log("\nðŸ“¡ TEST 1: Conectividad con aplicaciÃ³n", "info");
        try {
          const response = await fetch("http://localhost:5000");
          if (response.ok) {
            log("âœ… AplicaciÃ³n accesible en localhost:5000", "pass");
          } else {
            log("âŒ AplicaciÃ³n no responde correctamente", "fail");
          }
        } catch (e) {
          log("âŒ Error conectando con aplicaciÃ³n: " + e.message, "fail");
          return;
        }

        // Test 2: Verificar endpoint de sugerencias
        log("\nðŸ” TEST 2: API de sugerencias", "info");
        try {
          const response = await fetch("http://localhost:5000/api/sugerencias");
          if (response.ok) {
            const data = await response.json();
            log("âœ… API sugerencias responde correctamente", "pass");
            log(
              `ðŸ“Š Datos recibidos: ${data.medidas?.length || 0} medidas, ${data.marcas?.length || 0} marcas`,
              "info"
            );

            // Mostrar sample de datos
            if (data.medidas && data.medidas.length > 0) {
              log(`ðŸ”¸ Medidas ejemplo: ${data.medidas.slice(0, 3).join(", ")}...`, "info");
            }
            if (data.marcas && data.marcas.length > 0) {
              log(`ðŸ”¸ Marcas ejemplo: ${data.marcas.slice(0, 3).join(", ")}...`, "info");
            }
          } else {
            log("âŒ API sugerencias falla: " + response.status, "fail");
          }
        } catch (e) {
          log("âŒ Error en API sugerencias: " + e.message, "fail");
        }

        // Test 3: Simular request de validaciÃ³n
        log("\nðŸ“ TEST 3: LÃ³gica de validaciÃ³n", "info");

        // Simular datos de entrada
        const testData = {
          medida: "175/65 R14",
          cantidad: "2",
          marca: "MICHELIN",
          neto: "45.50",
          ganancia: "", // VacÃ­o para test
          ecotasa: "", // VacÃ­o para test
          iva: "", // VacÃ­o para test
        };

        log("ðŸ§ª Datos de prueba:", "info");
        Object.keys(testData).forEach((key) => {
          log(
            `   ${key}: "${testData[key]}" ${testData[key] ? "âœ…" : "âŒ"}`,
            testData[key] ? "pass" : "warning"
          );
        });

        // Simular validaciÃ³n bÃ¡sica (4 campos)
        const validacionBasica =
          testData.medida && testData.cantidad && testData.marca && testData.neto;
        log(
          `\nðŸ“‹ VALIDACIÃ“N BÃSICA (4 campos): ${validacionBasica ? "âœ… PASS" : "âŒ FAIL"}`,
          validacionBasica ? "pass" : "fail"
        );

        // Simular validaciÃ³n completa (7 campos)
        const validacionCompleta =
          testData.medida &&
          testData.cantidad &&
          testData.marca &&
          testData.neto &&
          testData.ganancia &&
          testData.ecotasa &&
          testData.iva;
        log(
          `ðŸ“‹ VALIDACIÃ“N COMPLETA (7 campos): ${validacionCompleta ? "âœ… PASS" : "âŒ FAIL"}`,
          validacionCompleta ? "pass" : "fail"
        );

        if (validacionBasica && !validacionCompleta) {
          log("âš ï¸ PROBLEMA DETECTADO: ValidaciÃ³n bÃ¡sica pasa pero completa falla", "warning");
          log(
            "ðŸ’¡ SOLUCIÃ“N: La funciÃ³n auto-add debe usar validaciÃ³n BÃSICA, no completa",
            "warning"
          );
        }

        // Test 4: Verificar estructura HTML esperada
        log("\nðŸ—ï¸ TEST 4: SimulaciÃ³n de estructura HTML", "info");

        const expectedElements = [
          "presupuesto-medida",
          "presupuesto-cantidad",
          "presupuesto-marca-temp",
          "presupuesto-neto-temp",
          "presupuesto-ganancia",
          "presupuesto-ecotasa",
          "presupuesto-iva",
          "btnAgregarMarca",
        ];

        log("ðŸ“‹ Elementos requeridos en DOM:", "info");
        expectedElements.forEach((id) => {
          log(`   #${id}: Se espera que exista`, "info");
        });

        log("\nâœ… TESTS COMPLETADOS", "pass");
        log(
          "ðŸ”§ PRÃ“XIMO PASO: Abrir http://localhost:5000 y ejecutar testAutoAdd() en consola",
          "info"
        );
        log("ðŸ’¡ TIP: Abre F12 > Consola en el navegador para ver logs detallados", "info");
      }

      // Ejecutar tests al cargar
      runTests();
    </script>
  </body>
</html>
