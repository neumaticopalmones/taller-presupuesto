<!doctype html>
<html>
  <head>
    <title>Test API Pedidos - Fechas</title>
    <meta charset="UTF-8" />
  </head>
  <body>
    <h1>Test API Pedidos - Verificaci√≥n de Fechas</h1>
    <button onclick="testPedidos()">Cargar Pedidos</button>
    <div id="resultado"></div>

    <script>
      async function testPedidos() {
        try {
          const response = await fetch("/api/pedidos");
          const data = await response.json();

          document.getElementById("resultado").innerHTML =
            "<pre>" + JSON.stringify(data, null, 2) + "</pre>";

          // Mostrar fechas espec√≠ficamente
          if (data.pedidos && data.pedidos.length > 0) {
            const primer = data.pedidos[0];
            console.log("Primer pedido fechas:", {
              created_at: primer.created_at,
              confirmed_at: primer.confirmed_at,
              received_at: primer.received_at,
            });

            console.log("Informaci√≥n del presupuesto:", {
              presupuesto: primer.presupuesto,
              vista_cliente: primer.presupuesto?.vista_cliente,
              vista_interna: primer.presupuesto?.vista_interna,
            });
          }
        } catch (error) {
          document.getElementById("resultado").innerHTML = "Error: " + error.message;
        }
      }

      // Funciones de formateo para probar
      function formatearFecha(fechaISO) {
        if (!fechaISO) return "";
        const fecha = new Date(fechaISO);
        const dia = fecha.getDate().toString().padStart(2, "0");
        const mes = (fecha.getMonth() + 1).toString().padStart(2, "0");
        const a√±o = fecha.getFullYear();
        const horas = fecha.getHours().toString().padStart(2, "0");
        const minutos = fecha.getMinutes().toString().padStart(2, "0");
        return `${dia}/${mes}/${a√±o} ${horas}:${minutos}`;
      }

      // Funci√≥n para crear historial de estados
      function crearHistorialEstados(pedido) {
        const historial = [];

        // Creado
        if (pedido.created_at) {
          historial.push(`üìù Creado: ${formatearFecha(pedido.created_at)}`);
        }

        // Confirmado
        if (pedido.confirmed_at) {
          historial.push(`‚úÖ Confirmado: ${formatearFecha(pedido.confirmed_at)}`);
        }

        // Recibido
        if (pedido.received_at) {
          historial.push(`üì¶ Recibido: ${formatearFecha(pedido.received_at)}`);
        }

        return historial.join("<br>");
      }

      // Probar formateo
      function testFormateo() {
        const fechaTest = "2025-01-15T14:30:00";
        console.log("Fecha test:", formatearFecha(fechaTest));

        const pedidoTest = {
          created_at: "2025-01-15T10:00:00",
          confirmed_at: "2025-01-15T14:30:00",
          received_at: null,
        };
        console.log("Historial test:", crearHistorialEstados(pedidoTest));
      }

      // Ejecutar test de formateo al cargar
      testFormateo();
    </script>
  </body>
</html>
