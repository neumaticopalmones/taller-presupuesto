<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Neumáticos Palmones - Presupuestos</title>

    <!-- Materialize CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
    />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />

    <!-- Favicon inline para evitar 404 en /favicon.ico -->
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect fill='%230b63f6' width='64' height='64' rx='8'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-size='36' font-family='Segoe UI, Arial' fill='white'%3EN%3C/text%3E%3C/svg%3E"
    />

    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <nav class="z-depth-1">
      <div class="nav-wrapper nav-dark">
        <a href="#" class="brand-logo center">Neumáticos Palmones</a>
        <ul id="nav-mobile" class="left hide-on-med-and-down">
          <li>
            <a href="#presupuestos-view" class="nav-link"
              ><i class="material-icons left">assignment</i>Presupuestos</a
            >
          </li>
          <li>
            <a href="#historial-view" class="nav-link"
              ><i class="material-icons left">history</i>Historial</a
            >
          </li>
        </ul>
      </div>
    </nav>

    <div class="container">
      <!-- Barra de acciones fija -->
      <section id="top-actions" class="no-imprimir">
        <div class="actions-bar card z-depth-1">
          <div class="card-content actions-content">
            <div class="left">
              <span
                ><span id="connDot" class="status-dot" title="Estado de conexión"></span
                ><span id="connText">Comprobando conexión…</span></span
              >
              <button type="button" id="btnCopyHostURL" class="btn-flat btn-ghost">
                <i class="material-icons left">link</i>Copiar enlace
              </button>
            </div>
            <div class="right actions-buttons">
              <div class="ribbon">
                <div class="ribbon-row">
                  <div class="ribbon-group" data-title="General">
                    <button
                      type="button"
                      id="btnGuardarPresupuesto"
                      class="btn waves-effect waves-light green"
                    >
                      <i class="material-icons left">save</i>Guardar
                    </button>
                    <button
                      type="button"
                      id="btnGuardarComoNuevo"
                      class="btn waves-effect waves-light blue"
                      style="display: none"
                    >
                      <i class="material-icons left">note_add</i>Guardar como nuevo
                    </button>
                    <button type="button" id="btnVerHistorial" class="btn waves-effect waves-light">
                      <i class="material-icons left">history</i>Historial
                    </button>
                  </div>
                  <div class="ribbon-group" data-title="Compartir">
                    <button
                      type="button"
                      id="btnCapturaWhatsApp"
                      class="btn waves-effect waves-light"
                    >
                      <i class="material-icons left">image</i>Captura + WhatsApp
                    </button>
                    <button
                      type="button"
                      id="btnCompartirWhatsApp"
                      class="btn waves-effect waves-light green"
                    >
                      <i class="material-icons left">chat</i>WhatsApp (texto)
                    </button>
                    <button
                      type="button"
                      id="btnImprimirPresupuesto"
                      class="btn waves-effect waves-light blue"
                    >
                      <i class="material-icons left">print</i>Imprimir
                    </button>
                    <button type="button" id="btnDescargarPDF" class="btn waves-effect waves-light">
                      <i class="material-icons left">picture_as_pdf</i>PDF
                    </button>
                  </div>
                  <div class="ribbon-group" data-title="Presupuesto">
                    <button
                      type="button"
                      id="btnVaciarGrupos"
                      class="btn waves-effect waves-light red"
                    >
                      <i class="material-icons left">delete_sweep</i>Vaciar
                    </button>
                  </div>
                  <div class="ribbon-group" data-title="Calendar">
                    <button
                      type="button"
                      id="btnCopiarCalendar"
                      class="btn waves-effect waves-light orange"
                    >
                      <i class="material-icons left">content_copy</i>Copiar Calendar
                    </button>
                    <button
                      type="button"
                      id="btnAbrirCalendar"
                      class="btn waves-effect waves-light orange darken-2"
                    >
                      <i class="material-icons left">event</i>Abrir Calendar
                    </button>
                  </div>
                </div>
                <div class="ribbon-row ribbon-secondary">
                  <div class="top-prefs" style="display: flex; align-items: center; gap: 10px">
                    <label style="display: flex; align-items: center; gap: 6px; margin: 0">
                      <input type="checkbox" id="toggleCompactoTop" />
                      <span>Modo compacto</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 6px; margin: 0">
                      <input type="checkbox" id="toggleExtraCompactoTop" />
                      <span>Extra-compacto</span>
                    </label>
                    <button
                      type="button"
                      id="btnCancelarEdicionTop"
                      class="btn waves-effect waves-light grey"
                    >
                      <i class="material-icons left">undo</i>Cancelar
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <header class="header">
        <h1>NEUMÁTICOS PALMONES</h1>
        <p>
          C/GALEON 25. POLÍGONO 1 PALMONES<br />
          11379 Los Barrios<br />
          neumaticospalmones@hotmail.com<br />
          Tlf: 659718809
        </p>
      </header>

      <!-- Datos cliente + meta -->
      <section id="presupuestos-view" class="cliente-section no-imprimir app-section card">
        <div class="card-content">
          <form id="cliente-form" onsubmit="return false;">
            <div class="form-errors" style="display: none"></div>
            <fieldset>
              <legend><i class="material-icons left">person</i>Datos del cliente</legend>
              <div class="row">
                <div class="input-field col s4">
                  <input type="text" id="presupuesto-nombreCliente" class="validate" />
                  <label for="presupuesto-nombreCliente">Nombre y Apellidos</label>
                </div>
                <div class="input-field col s4">
                  <input type="tel" id="presupuesto-telefonoCliente" class="validate" />
                  <label for="presupuesto-telefonoCliente">Teléfono</label>
                </div>
                <div class="input-field col s4">
                  <input type="text" id="presupuesto-nifCliente" class="validate" />
                  <label for="presupuesto-nifCliente">NIF/CIF</label>
                </div>
              </div>

              <div class="row">
                <div class="input-field col s6">
                  <input type="text" id="presupuesto-numeroPresupuesto" class="validate" />
                  <label for="presupuesto-numeroPresupuesto">Nº de Presupuesto</label>
                </div>
                <div class="input-field col s6">
                  <input type="date" id="presupuesto-fechaPresupuesto" class="validate" />
                  <label for="presupuesto-fechaPresupuesto" class="active">Fecha</label>
                </div>
              </div>

              <div class="row">
                <div class="input-field col s4">
                  <input type="text" id="presupuesto-distribuidor" class="validate" />
                  <label for="presupuesto-distribuidor">Distribuidor</label>
                </div>
                <div class="input-field col s4">
                  <input type="text" id="presupuesto-descripcion" class="validate" />
                  <label for="presupuesto-descripcion">Descripción (para Calendar)</label>
                </div>
                <div class="input-field col s4">
                  <input type="text" id="presupuesto-observaciones" class="validate" />
                  <label for="presupuesto-observaciones"
                    >Observaciones (*** en título si rellenas)</label
                  >
                </div>
              </div>
            </fieldset>
          </form>
        </div>
      </section>

      <!-- Añadir grupo -->
      <section id="productos-view" class="productos-section no-imprimir app-section card">
        <div class="card-content">
          <form id="producto-form" onsubmit="return false;">
            <div class="form-errors" style="display: none"></div>
            <fieldset>
              <legend>
                <i class="material-icons left">add_circle</i>Añadir Grupo de Productos
              </legend>
              <div class="row">
                <div class="input-field col s3">
                  <input type="text" id="presupuesto-medida" />
                  <label for="presupuesto-medida">Medida (para neumáticos)</label>
                </div>
                <div class="input-field col s2">
                  <input type="number" id="presupuesto-cantidad" min="1" value="2" />
                  <label for="presupuesto-cantidad">Cantidad</label>
                </div>
                <div class="input-field col s2">
                  <input type="number" id="presupuesto-ganancia" step="0.01" value="0" />
                  <label for="presupuesto-ganancia">Ganancia (€)</label>
                </div>
                <div class="input-field col s2">
                  <input type="number" id="presupuesto-ecotasa" step="0.01" value="0" />
                  <label for="presupuesto-ecotasa">Ecotasa (€)</label>
                </div>
                <div class="input-field col s2">
                  <input type="number" id="presupuesto-iva" step="0.01" value="21" />
                  <label for="presupuesto-iva">IVA (%)</label>
                </div>
              </div>
              <div class="row" style="margin-top: -10px">
                <div class="col s12">
                  <div
                    id="precios-filtros-codigo"
                    class="chips-container"
                    style="margin-bottom: 6px"
                  ></div>
                  <div id="precios-por-medida" class="chips-container"></div>
                </div>
              </div>

              <div class="row">
                <div class="input-field col s5">
                  <input type="text" id="presupuesto-marca-temp" />
                  <label for="presupuesto-marca-temp">Marca</label>
                </div>
                <div class="input-field col s5">
                  <input type="number" id="presupuesto-neto-temp" step="0.01" />
                  <label for="presupuesto-neto-temp">Neto (€)</label>
                </div>
                <div class="input-field col s2">
                  <button type="button" id="btnAgregarMarca" class="btn waves-effect waves-light">
                    + Añadir
                  </button>
                </div>
              </div>
              <ul id="lista-marcas-temp"></ul>
              <hr />

              <legend><i class="material-icons left">handyman</i>Añadir Trabajo</legend>
              <div class="row">
                <div class="input-field col s6">
                  <input type="text" id="presupuesto-otro-concepto" />
                  <label for="presupuesto-otro-concepto">Concepto</label>
                </div>
                <div class="input-field col s4">
                  <input type="number" id="presupuesto-otro-precio" step="0.01" />
                  <label for="presupuesto-otro-precio">Precio Final (€)</label>
                </div>
                <div class="input-field col s2">
                  <button
                    type="button"
                    id="btnAgregarOtroTrabajo"
                    class="btn waves-effect waves-light"
                  >
                    + Añadir
                  </button>
                </div>
              </div>
              <ul id="lista-otros-trabajos-temp"></ul>
              <hr />

              <button
                type="button"
                id="btnAgregarGrupo"
                class="btn-large waves-effect waves-light"
                style="width: 100%"
              >
                <i class="material-icons left">playlist_add</i>Agregar Grupo al Presupuesto
              </button>
            </fieldset>
          </form>
        </div>
      </section>

      <!-- Presupuesto final -->
      <section id="presupuesto-final-view" class="presupuesto-section app-section card">
        <div class="card-content">
          <div class="presupuesto-meta" id="presupuesto-meta"></div>
          <h2><i class="material-icons left">receipt</i>Presupuesto</h2>
          <div id="presupuesto-final-render"></div>
        </div>
      </section>

      <!-- Preferencias rápidas -->
      <section id="acciones-finales-view" class="acciones-finales no-imprimir app-section card">
        <div
          class="card-content"
          style="display: flex; align-items: center; justify-content: space-between; gap: 16px"
        >
          <div>
            <label>
              <input type="checkbox" id="toggleCompacto" />
              <span>Modo compacto</span>
            </label>
            <label style="margin-left: 16px">
              <input type="checkbox" id="toggleExtraCompacto" />
              <span>Extra-compacto</span>
            </label>
          </div>
          <div>
            <button
              type="button"
              id="btnCancelarEdicion"
              class="btn waves-effect waves-light grey"
              style="display: none"
            >
              <i class="material-icons left">undo</i>Cancelar
            </button>
          </div>
        </div>
      </section>

      <!-- Campos extra para Calendar -->
      <section class="no-imprimir app-section card" style="margin-top: 10px">
        <div class="card-content">
          <fieldset>
            <legend>
              <i class="material-icons left">event</i>Datos para Calendar (opcionales)
            </legend>
            <div class="row" style="margin-bottom: 0">
              <div class="input-field col s3">
                <input type="date" id="calendar-fecha" />
                <label for="calendar-fecha" class="active">Fecha cita</label>
              </div>
              <div class="input-field col s3">
                <input type="time" id="calendar-hora" />
                <label for="calendar-hora" class="active">Hora</label>
              </div>
              <div class="input-field col s2">
                <input type="number" id="calendar-duracion" min="15" step="15" value="60" />
                <label for="calendar-duracion" class="active">Duración (min)</label>
              </div>
              <div class="input-field col s2">
                <input type="text" id="calendar-proveedor" />
                <label for="calendar-proveedor">Proveedor</label>
              </div>
              <div class="input-field col s2">
                <input type="number" id="calendar-porte" step="0.01" />
                <label for="calendar-porte">Porte (€)</label>
              </div>
            </div>
            <div class="row" style="margin-bottom: 0">
              <div class="input-field col s12">
                <input type="text" id="calendar-nota" />
                <label for="calendar-nota">Nota</label>
              </div>
            </div>
          </fieldset>
        </div>
      </section>

      <!-- Historial -->
      <section id="historial-view" class="historial-section no-imprimir app-section card">
        <div class="card-content">
          <h2><i class="material-icons left">history</i>Historial de Presupuestos</h2>
          <button
            type="button"
            id="btnVolverPresupuestos"
            class="btn waves-effect waves-light grey"
            style="margin-bottom: 16px"
          >
            Volver
          </button>
          <div class="row" style="margin-bottom: 0">
            <div class="input-field col s4">
              <input type="text" id="hist-buscar-nombre" />
              <label for="hist-buscar-nombre">Nombre</label>
            </div>
            <div class="input-field col s4">
              <input type="text" id="hist-buscar-telefono" />
              <label for="hist-buscar-telefono">Teléfono</label>
            </div>
            <div class="input-field col s4">
              <input type="text" id="hist-buscar-numero" />
              <label for="hist-buscar-numero">Nº Presupuesto</label>
            </div>
          </div>
          <div class="row" style="margin-top: -10px">
            <div class="col s12 right-align">
              <button type="button" id="hist-buscar-btn" class="btn waves-effect waves-light blue">
                Buscar
              </button>
              <button type="button" id="hist-limpiar-btn" class="btn waves-effect waves-light grey">
                Limpiar
              </button>
            </div>
          </div>
          <ul id="lista-historial" class="collection"></ul>
          <div id="paginacion-container"></div>
          <div class="card" style="margin-top: 16px">
            <div class="card-content">
              <span class="card-title">Sugerencias (medidas y marcas)</span>
              <div class="row" style="margin-bottom: 0">
                <div class="input-field col s3">
                  <input type="number" id="sug-limit" min="1" value="200" />
                  <label for="sug-limit" class="active">Analizar últimos (N) registros</label>
                </div>
                <div class="col s3" style="margin-top: 24px">
                  <button
                    type="button"
                    id="btnCargarSugerencias"
                    class="btn waves-effect waves-light"
                  >
                    Cargar sugerencias
                  </button>
                </div>
              </div>
              <div class="row" style="margin-bottom: 0">
                <div class="col s6">
                  <h6>Medidas frecuentes</h6>
                  <div id="sug-medidas" class="chips-container"></div>
                </div>
                <div class="col s6">
                  <h6>Marcas frecuentes</h6>
                  <div id="sug-marcas" class="chips-container"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Materialize JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <!-- Captura HTML a imagen / PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script type="module" src="js/main.js"></script>
  </body>
</html>
