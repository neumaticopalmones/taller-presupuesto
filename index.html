<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Neumáticos Palmones - Presupuestos</title>

    <!-- Materialize CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
    />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />

    <!-- Tailwind CSS para modernizar diseño -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Favicon inline para evitar 404 en /favicon.ico -->
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect fill='%230b63f6' width='64' height='64' rx='8'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-size='36' font-family='Segoe UI, Arial' fill='white'%3EN%3C/text%3E%3C/svg%3E"
    />

    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- Toolbar moderno estilo ERP -->
    <div class="bg-white border-b border-gray-200 shadow-sm">
      <div class="flex items-center justify-between px-4 py-2.5">
        <!-- Marca y badge -->
        <div class="flex items-center space-x-4">
          <div class="flex items-center space-x-2">
            <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
              <span class="text-white font-bold text-sm">N</span>
            </div>
            <h1 class="text-gray-900 font-semibold text-lg">Neumáticos Palmones</h1>
          </div>
          <span
            id="loaded-presupuesto-badge"
            class="hidden px-2 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded-full"
            data-badge-caption=""
          ></span>
        </div>

        <!-- Grupos de botones -->
        <div class="flex items-center space-x-6">
          <!-- Grupo: Presupuestos -->
          <div class="flex items-center space-x-1">
            <button
              id="btnNuevoPresupuesto"
              class="inline-flex items-center px-3 py-1.5 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"
            >
              <i class="material-icons text-sm mr-1">add</i>Nuevo
            </button>
            <button
              id="btnGuardarPresupuesto"
              class="inline-flex items-center px-3 py-1.5 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors"
            >
              <i class="material-icons text-sm mr-1">save</i>Guardar
            </button>
            <button
              id="btnCancelarEdicionTop"
              class="hidden inline-flex items-center px-3 py-1.5 border border-transparent text-sm font-medium rounded-md text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 transition-colors"
            >
              <i class="material-icons text-sm mr-1">cancel</i>Cancelar
            </button>
          </div>

          <!-- Grupo: Navegación -->
          <div class="flex items-center space-x-1">
            <button
              id="btnVerHistorial"
              class="inline-flex items-center px-3 py-1.5 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"
            >
              <i class="material-icons text-sm mr-1">history</i>Historial
            </button>
            <button
              id="btnVerPedidos"
              class="inline-flex items-center px-3 py-1.5 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"
            >
              <i class="material-icons text-sm mr-1">shopping_cart</i>Pedidos
            </button>
          </div>

          <!-- Grupo: Exportar -->
          <div class="flex items-center space-x-1">
            <button
              id="btnImprimirPresupuesto"
              class="inline-flex items-center px-3 py-1.5 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"
            >
              <i class="material-icons text-sm mr-1">print</i>PDF
            </button>
            <button
              id="btnCompartirWhatsApp"
              class="inline-flex items-center px-3 py-1.5 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"
            >
              <i class="material-icons text-sm mr-1">message</i>WhatsApp
            </button>
          </div>

          <!-- Grupo: Acciones -->
          <div class="flex items-center space-x-1">
            <button
              id="btnVaciarGrupos"
              class="inline-flex items-center px-3 py-1.5 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"
            >
              <i class="material-icons text-sm mr-1">clear_all</i>Vaciar
            </button>
            <button
              id="btnCargarSugerencias"
              class="inline-flex items-center px-3 py-1.5 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"
            >
              <i class="material-icons text-sm mr-1">lightbulb_outline</i>Sugerencias
            </button>
          </div>

          <!-- Grupo: Vista y herramientas -->
          <div class="flex items-center space-x-3">
            <label
              class="flex items-center space-x-2 text-sm text-gray-700 cursor-pointer"
              title="Vista extra compacta"
            >
              <input
                type="checkbox"
                id="toggleExtraCompactoTop"
                class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
              />
              <span>Extra</span>
            </label>

            <div class="flex items-center space-x-2 pl-3 border-l border-gray-200">
              <div class="flex items-center space-x-1">
                <span
                  id="connDot"
                  class="w-2 h-2 bg-green-500 rounded-full"
                  title="Estado de conexión"
                ></span>
                <span id="connText" class="text-xs text-gray-500">Conectado</span>
              </div>
              <button
                id="btnCopyHostURL"
                class="inline-flex items-center p-1.5 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"
              >
                <i class="material-icons text-sm">link</i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Container principal moderno -->
    <div class="bg-gray-50 min-h-screen">
      <div class="max-w-full mx-auto p-4 grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Sección izquierda: Cliente y productos -->
        <div class="lg:col-span-2 space-y-6" id="presupuestos-view">
          <!-- Datos cliente modernos -->
          <div class="bg-white rounded-lg shadow-sm border border-gray-200">
            <div class="px-6 py-4 border-b border-gray-200">
              <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                <i class="material-icons text-blue-600 mr-2">person</i>
                Datos del Cliente
              </h2>
            </div>
            <div class="p-6">
              <form id="cliente-form" onsubmit="return false;">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <div class="space-y-4">
                    <div>
                      <label
                        for="presupuesto-nombreCliente"
                        class="block text-sm font-medium text-gray-700 mb-1"
                        >Nombre y Apellidos</label
                      >
                      <input
                        type="text"
                        id="presupuesto-nombreCliente"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      />
                    </div>
                    <div>
                      <label
                        for="presupuesto-numeroPresupuesto"
                        class="block text-sm font-medium text-gray-700 mb-1"
                        >Nº Presupuesto</label
                      >
                      <input
                        type="text"
                        id="presupuesto-numeroPresupuesto"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      />
                    </div>
                    <div>
                      <label
                        for="presupuesto-distribuidor"
                        class="block text-sm font-medium text-gray-700 mb-1"
                        >Distribuidor</label
                      >
                      <input
                        type="text"
                        id="presupuesto-distribuidor"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      />
                    </div>
                  </div>
                  <div class="space-y-4">
                    <div>
                      <label
                        for="presupuesto-telefonoCliente"
                        class="block text-sm font-medium text-gray-700 mb-1"
                        >Teléfono</label
                      >
                      <input
                        type="tel"
                        id="presupuesto-telefonoCliente"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      />
                    </div>
                    <div>
                      <label
                        for="presupuesto-fechaPresupuesto"
                        class="block text-sm font-medium text-gray-700 mb-1"
                        >Fecha</label
                      >
                      <input
                        type="date"
                        id="presupuesto-fechaPresupuesto"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      />
                    </div>
                    <div>
                      <label
                        for="presupuesto-descripcion"
                        class="block text-sm font-medium text-gray-700 mb-1"
                        >Descripción (Calendar)</label
                      >
                      <input
                        type="text"
                        id="presupuesto-descripcion"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      />
                    </div>
                  </div>
                  <div class="space-y-4">
                    <div>
                      <label
                        for="presupuesto-nifCliente"
                        class="block text-sm font-medium text-gray-700 mb-1"
                        >NIF/CIF</label
                      >
                      <input
                        type="text"
                        id="presupuesto-nifCliente"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      />
                    </div>
                    <div class="md:col-span-1">
                      <label
                        for="presupuesto-observaciones"
                        class="block text-sm font-medium text-gray-700 mb-1"
                        >Observaciones</label
                      >
                      <input
                        type="text"
                        id="presupuesto-observaciones"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      />
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>

          <!-- Añadir productos moderno -->
          <div class="bg-white rounded-lg shadow-sm border border-gray-200" id="productos-view">
            <div class="px-6 py-4 border-b border-gray-200">
              <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                <i class="material-icons text-green-600 mr-2">add_shopping_cart</i>
                Añadir Productos
              </h2>
            </div>
            <div class="p-6">
              <form id="producto-form" onsubmit="return false;">
                <div class="grid grid-cols-1 md:grid-cols-8 gap-3 mb-4">
                  <div class="md:col-span-2">
                    <label
                      for="presupuesto-medida"
                      class="block text-sm font-medium text-gray-700 mb-1"
                      >Medida</label
                    >
                    <input
                      type="text"
                      id="presupuesto-medida"
                      class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    />
                  </div>
                  <div>
                    <label
                      for="presupuesto-cantidad"
                      class="block text-sm font-medium text-gray-700 mb-1"
                      >Cant.</label
                    >
                    <input
                      type="number"
                      id="presupuesto-cantidad"
                      min="1"
                      value="2"
                      class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    />
                  </div>
                  <div class="md:col-span-2">
                    <label
                      for="presupuesto-marca-temp"
                      class="block text-sm font-medium text-gray-700 mb-1"
                      >Marca</label
                    >
                    <input
                      type="text"
                      id="presupuesto-marca-temp"
                      class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    />
                  </div>
                  <div>
                    <label
                      for="presupuesto-neto-temp"
                      class="block text-sm font-medium text-gray-700 mb-1"
                      >Precio Neto</label
                    >
                    <input
                      type="number"
                      id="presupuesto-neto-temp"
                      step="0.01"
                      class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    />
                  </div>
                  <div>
                    <label
                      for="presupuesto-ganancia"
                      class="block text-sm font-medium text-gray-700 mb-1"
                      >Ganancia</label
                    >
                    <input
                      type="number"
                      id="presupuesto-ganancia"
                      step="0.01"
                      value="0"
                      class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    />
                  </div>
                  <div>
                    <label
                      for="presupuesto-ecotasa"
                      class="block text-sm font-medium text-gray-700 mb-1"
                      >Ecotasa</label
                    >
                    <input
                      type="number"
                      id="presupuesto-ecotasa"
                      step="0.01"
                      value="0"
                      class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    />
                  </div>
                  <div>
                    <label
                      for="presupuesto-iva"
                      class="block text-sm font-medium text-gray-700 mb-1"
                      >IVA %</label
                    >
                    <input
                      type="number"
                      id="presupuesto-iva"
                      step="0.01"
                      value="21"
                      class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    />
                  </div>
                  <div class="flex items-end">
                    <button
                      type="button"
                      id="btnAgregarMarca"
                      class="w-full px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"
                    >
                      <i class="material-icons text-sm mr-1">add</i>
                      Añadir
                    </button>
                  </div>
                </div>

                <!-- Sugerencias modernas -->
                <div class="space-y-4">
                  <div>
                    <h3 class="text-sm font-medium text-gray-700 mb-2">Sugerencias por Medida</h3>
                    <div class="flex flex-wrap gap-2" id="precios-por-medida"></div>
                  </div>
                  <div>
                    <h3 class="text-sm font-medium text-gray-700 mb-2">Códigos Filtrados</h3>
                    <div class="flex flex-wrap gap-2" id="precios-filtros-codigo"></div>
                  </div>
                </div>

                <!-- Marcas temporales modernas -->
                <div class="mt-6 space-y-4">
                  <div id="lista-marcas-temp"></div>
                  <div id="lista-otros-trabajos-temp"></div>

                  <!-- Botones de acción principales -->
                  <div class="flex gap-3">
                    <button
                      type="button"
                      id="btnAgregarOtroTrabajo"
                      class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors"
                    >
                      <i class="material-icons text-sm mr-1">build</i>
                      Otro Trabajo
                    </button>
                    <button
                      type="button"
                      id="btnAgregarGrupo"
                      class="flex-1 inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"
                    >
                      <i class="material-icons text-sm mr-1">playlist_add</i>
                      Agregar Grupo
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>

          <!-- Tabla de productos moderna -->
          <div class="bg-white rounded-lg shadow-sm border border-gray-200">
            <div class="px-6 py-4 border-b border-gray-200">
              <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                <i class="material-icons text-blue-600 mr-2">list</i>
                Lista de Productos
              </h2>
            </div>
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Medida
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Cant.
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Marca
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Precio Unit.
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Total
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Acc.
                    </th>
                  </tr>
                </thead>
                <tbody id="items-list" class="bg-white divide-y divide-gray-200">
                  <!-- Productos dinámicos -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Panel derecho moderno -->
        <div class="lg:col-span-1 space-y-6">
          <!-- Presupuesto final moderno -->
          <div
            class="bg-white rounded-lg shadow-sm border border-gray-200"
            id="presupuesto-final-view"
          >
            <div class="px-6 py-4 border-b border-gray-200">
              <div class="flex justify-between items-start">
                <div>
                  <h3 class="text-lg font-bold text-gray-900">NEUMÁTICOS PALMONES</h3>
                  <p class="text-sm text-gray-600">C/GALEON 25 - Tel: 659 718 809</p>
                </div>
                <div class="text-right">
                  <h3 class="text-lg font-bold text-gray-900">PRESUPUESTO</h3>
                  <p class="text-sm text-gray-600" id="presupuesto-numero-display">Nº: ---</p>
                </div>
              </div>
            </div>

            <!-- Meta información del cliente -->
            <div
              id="presupuesto-meta"
              class="px-6 py-2 text-sm text-gray-600 border-b border-gray-200"
            ></div>

            <div class="p-6" id="presupuesto-final-content">
              <!-- Contenido dinámico del presupuesto -->
              <div id="presupuesto-final-render"></div>
            </div>
          </div>

          <!-- Acciones rápidas modernas -->
          <div
            class="bg-white rounded-lg shadow-sm border border-gray-200"
            id="acciones-finales-view"
          >
            <div class="px-6 py-4 border-b border-gray-200">
              <h3 class="text-lg font-semibold text-gray-900">Acciones Rápidas</h3>
            </div>
            <div class="p-4">
              <div class="grid grid-cols-2 gap-2">
                <button
                  class="hidden w-full px-3 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"
                  id="btnGuardarComoNuevo"
                >
                  <i class="material-icons text-sm mr-1">content_copy</i>
                  Guardar como Nuevo
                </button>
                <button
                  class="w-full px-3 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors"
                  id="btnVaciarTemporales"
                >
                  <i class="material-icons text-sm mr-1">delete_sweep</i>
                  Vaciar Temp.
                </button>
                <button
                  class="w-full px-3 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors"
                  id="btnDescargarPDF"
                >
                  <i class="material-icons text-sm mr-1">picture_as_pdf</i>
                  PDF
                </button>
                <button
                  class="w-full px-3 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors"
                  id="btnCapturaWhatsApp"
                >
                  <i class="material-icons text-sm mr-1">photo_camera</i>
                  Captura
                </button>
                <button
                  class="w-full px-3 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors"
                  id="btnCopiarCalendar"
                >
                  <i class="material-icons text-sm mr-1">event</i>
                  Copiar Cal.
                </button>
                <button
                  class="w-full px-3 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors"
                  id="btnAbrirCalendar"
                >
                  <i class="material-icons text-sm mr-1">open_in_new</i>
                  Abrir Cal.
                </button>
                <button
                  class="hidden w-full px-3 py-2 text-sm font-medium text-white bg-orange-600 rounded-md hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 transition-colors col-span-2"
                  id="btnCancelarEdicion"
                >
                  <i class="material-icons text-sm mr-1">undo</i>
                  Cancelar Edición
                </button>
              </div>
            </div>
          </div>

          <!-- Calendar rápido moderno -->
          <div class="bg-white rounded-lg shadow-sm border border-gray-200">
            <div class="px-6 py-4 border-b border-gray-200">
              <h3 class="text-lg font-semibold text-gray-900">Programar Cita</h3>
            </div>
            <div class="p-4 space-y-4">
              <div>
                <label for="calendar-fecha" class="block text-sm font-medium text-gray-700 mb-1"
                  >Fecha cita</label
                >
                <input
                  type="date"
                  id="calendar-fecha"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                />
              </div>
              <div class="grid grid-cols-2 gap-3">
                <div>
                  <label for="calendar-hora" class="block text-sm font-medium text-gray-700 mb-1"
                    >Hora</label
                  >
                  <input
                    type="time"
                    id="calendar-hora"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  />
                </div>
                <div>
                  <label
                    for="calendar-duracion"
                    class="block text-sm font-medium text-gray-700 mb-1"
                    >Duración (min)</label
                  >
                  <input
                    type="number"
                    id="calendar-duracion"
                    value="60"
                    min="5"
                    step="5"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  />
                </div>
              </div>
              <div>
                <label for="calendar-proveedor" class="block text-sm font-medium text-gray-700 mb-1"
                  >Distribuidor (opcional)</label
                >
                <input
                  type="text"
                  id="calendar-proveedor"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                />
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modales del sistema -->

    <!-- Modal Historial -->
    <div id="historial-modal" class="modal-overlay" style="display: none">
      <div class="modal-content-historial">
        <div class="modal-header-historial">
          <h3>
            <i class="material-icons">history</i>
            Historial de Presupuestos
          </h3>
          <button
            id="btnVolverPresupuestos"
            class="modal-back"
            title="Volver a Presupuestos"
            style="margin-right: 8px"
          >
            <i class="material-icons">arrow_back</i>
          </button>
          <button class="modal-close" data-modal="historial-modal">
            <i class="material-icons">close</i>
          </button>
        </div>

        <!-- Panel de búsqueda -->
        <div class="search-panel-historial">
          <div class="search-inputs">
            <input type="text" id="hist-buscar-nombre" placeholder="Nombre cliente..." />
            <input type="text" id="hist-buscar-telefono" placeholder="Teléfono..." />
            <input type="text" id="hist-buscar-medida" placeholder="Medida..." />
            <input type="text" id="hist-buscar-numero" placeholder="Nº presupuesto..." />
            <button id="hist-buscar-btn" class="btn-search">
              <i class="material-icons">search</i>Buscar
            </button>
            <button id="hist-limpiar-btn" class="btn-clear">
              <i class="material-icons">clear</i>Limpiar
            </button>
          </div>
        </div>

        <!-- Estadísticas -->
        <div class="stats-panel-historial">
          <div class="stat-item">
            <div class="stat-number" id="stat-total">156</div>
            <div class="stat-label">Total Presupuestos</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="stat-monto">€12,450</div>
            <div class="stat-label">Monto Total</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="stat-mes">23</div>
            <div class="stat-label">Este Mes</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="stat-clientes">89</div>
            <div class="stat-label">Clientes Únicos</div>
          </div>
        </div>

        <!-- Lista de presupuestos -->
        <div class="presupuestos-list-historial">
          <div class="list-header">
            <span>Mostrando resultados de búsqueda</span>
            <div class="list-actions">
              <button class="btn-export">
                <i class="material-icons">file_download</i>Exportar
              </button>
            </div>
          </div>
          <div class="list-content" id="lista-historial">
            <!-- Lista dinámica de presupuestos -->
          </div>
        </div>

        <!-- Navegación -->
        <div class="modal-navigation">
          <div id="paginacion-container"></div>
        </div>
        <div
          class="modal-footer"
          style="display: flex; justify-content: flex-end; gap: 8px; padding: 10px 0"
        >
          <button id="btnVolverPresupuestosBottom" class="btn-clear" title="Volver a Presupuestos">
            <i class="material-icons">arrow_back</i>Volver
          </button>
        </div>
      </div>
    </div>

    <!-- Modal Pedidos -->
    <div id="pedidos-modal" class="modal-overlay" style="display: none">
      <div class="modal-content-pedidos">
        <div class="modal-header-pedidos">
          <h3>
            <i class="material-icons">shopping_cart</i>
            Gestión de Pedidos
          </h3>
          <button
            id="ped-btn-volver"
            class="modal-back"
            title="Volver a Presupuestos"
            style="margin-right: 8px"
          >
            <i class="material-icons">arrow_back</i>
          </button>
          <button class="modal-close" data-modal="pedidos-modal">
            <i class="material-icons">close</i>
          </button>
        </div>

        <!-- Filtros de pedidos -->
        <div class="filters-panel-pedidos">
          <div class="filters-row">
            <input type="text" id="ped-filtro-texto" placeholder="Buscar..." />
            <input type="text" id="ped-filtro-proveedor" placeholder="Proveedor..." />
            <select id="ped-filtro-estado">
              <option value="">Todos los estados</option>
              <option value="pending">Pendientes</option>
              <option value="ordered">Pedidos</option>
              <option value="received">Recibidos</option>
            </select>
            <input type="date" id="ped-filtro-desde" />
            <input type="date" id="ped-filtro-hasta" />
            <button id="ped-btn-filtrar" class="btn-filter">
              <i class="material-icons">filter_alt</i>Filtrar
            </button>
          </div>
          <div class="actions-row">
            <button id="ped-btn-nuevo" class="btn-new-pedido">
              <i class="material-icons">add</i>Nuevo Pedido
            </button>
            <button id="ped-btn-limpiar" class="btn-clear">
              <i class="material-icons">clear</i>Limpiar
            </button>
          </div>
        </div>

        <!-- Lista de pedidos -->
        <div class="pedidos-list">
          <div class="list-content" id="pedidos-lista">
            <!-- Lista dinámica de pedidos -->
          </div>
        </div>

        <!-- Paginación de pedidos -->
        <div class="modal-navigation">
          <div id="pedidos-paginacion"></div>
        </div>
        <div
          class="modal-footer"
          style="display: flex; justify-content: flex-end; gap: 8px; padding: 10px 0"
        >
          <button id="ped-btn-volver-bottom" class="btn-clear" title="Volver a Presupuestos">
            <i class="material-icons">arrow_back</i>Volver
          </button>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script type="module" src="js/main.js"></script>
    <script type="module" src="js/modal.js"></script>

    <!-- Loader Overlay -->
    <div id="loader-overlay" class="loader-overlay">
      <div class="loader-content">
        <div class="preloader-wrapper big active">
          <div class="spinner-layer spinner-blue-only">
            <div class="circle-clipper left">
              <div class="circle"></div>
            </div>
            <div class="gap-patch">
              <div class="circle"></div>
            </div>
            <div class="circle-clipper right">
              <div class="circle"></div>
            </div>
          </div>
        </div>
        <p id="loader-text">Procesando...</p>
      </div>
    </div>

    <!-- Modal de Confirmación Genérico -->
    <div id="confirm-modal" class="modal-modern">
      <div class="modal-overlay" id="modal-overlay"></div>
      <div class="modal-container">
        <div class="modal-header">
          <h4 id="confirm-modal-title" class="modal-title">
            <i class="material-icons left modal-icon">help_outline</i>
            Confirmar Acción
          </h4>
          <button class="modal-close-btn" id="modal-close-btn">
            <i class="material-icons">close</i>
          </button>
        </div>
        <div class="modal-body">
          <div class="modal-content-wrapper">
            <div class="modal-icon-large" id="modal-icon-large">
              <i class="material-icons">help_outline</i>
            </div>
            <div class="modal-text">
              <p id="confirm-modal-content" class="modal-message">
                ¿Estás seguro de realizar esta acción?
              </p>
              <p id="confirm-modal-subtitle" class="modal-subtitle" style="display: none">
                Esta acción no se puede deshacer.
              </p>
            </div>
          </div>
        </div>
        <div class="modal-footer-modern">
          <button class="btn-modal-modern secondary" id="confirm-modal-cancel">
            <i class="material-icons left">close</i>
            Cancelar
          </button>
          <button class="btn-modal-modern primary" id="confirm-modal-accept">
            <i class="material-icons left">check</i>
            Confirmar
          </button>
        </div>
      </div>
    </div>

    <!-- Modal de Información/Éxito -->
    <div id="info-modal" class="modal-modern">
      <div class="modal-overlay"></div>
      <div class="modal-container">
        <div class="modal-header">
          <h4 id="info-modal-title" class="modal-title">
            <i class="material-icons left modal-icon">info</i>
            Información
          </h4>
          <button class="modal-close-btn">
            <i class="material-icons">close</i>
          </button>
        </div>
        <div class="modal-body">
          <div class="modal-content-wrapper">
            <div class="modal-icon-large success" id="info-modal-icon">
              <i class="material-icons">check_circle</i>
            </div>
            <div class="modal-text">
              <p id="info-modal-content" class="modal-message">
                Operación completada exitosamente.
              </p>
            </div>
          </div>
        </div>
        <div class="modal-footer-modern">
          <button class="btn-modal-modern primary modal-close">
            <i class="material-icons left">done</i>
            Entendido
          </button>
        </div>
      </div>
    </div>

    <!-- Modal de Error -->
    <div id="error-modal" class="modal-modern">
      <div class="modal-overlay"></div>
      <div class="modal-container">
        <div class="modal-header error">
          <h4 id="error-modal-title" class="modal-title">
            <i class="material-icons left modal-icon">error</i>
            Error
          </h4>
          <button class="modal-close-btn">
            <i class="material-icons">close</i>
          </button>
        </div>
        <div class="modal-body">
          <div class="modal-content-wrapper">
            <div class="modal-icon-large error">
              <i class="material-icons">error</i>
            </div>
            <div class="modal-text">
              <p id="error-modal-content" class="modal-message">Ha ocurrido un error inesperado.</p>
              <p id="error-modal-details" class="modal-details" style="display: none"></p>
            </div>
          </div>
        </div>
        <div class="modal-footer-modern">
          <button class="btn-modal-modern secondary modal-close">
            <i class="material-icons left">close</i>
            Cerrar
          </button>
          <button class="btn-modal-modern primary" id="error-modal-retry" style="display: none">
            <i class="material-icons left">refresh</i>
            Reintentar
          </button>
        </div>
      </div>
    </div>

    <!-- Modal de Formulario -->
    <div id="form-modal" class="modal-modern modal-large">
      <div class="modal-overlay"></div>
      <div class="modal-container">
        <div class="modal-header">
          <h4 id="form-modal-title" class="modal-title">
            <i class="material-icons left modal-icon">edit</i>
            Editar Información
          </h4>
          <button class="modal-close-btn">
            <i class="material-icons">close</i>
          </button>
        </div>
        <div class="modal-body">
          <form id="form-modal-form" class="modal-form">
            <div id="form-modal-content" class="form-content">
              <!-- Contenido dinámico del formulario -->
            </div>
          </form>
        </div>
        <div class="modal-footer-modern">
          <button class="btn-modal-modern secondary modal-close">
            <i class="material-icons left">close</i>
            Cancelar
          </button>
          <button class="btn-modal-modern primary" id="form-modal-submit">
            <i class="material-icons left">save</i>
            Guardar
          </button>
        </div>
      </div>
    </div>
  </body>
</html>
